<div class="cart__content__heading d-flex" style="justify-content: space-between;">
    <div class="d-flex">
        <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
              x="0px" y="0px"
              width="30px" height="30px" viewBox="0 0 203.26 203.26" enable-background="new 0 0 203.26 203.26"
              xml:space="preserve">
<g>
    <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M190.986,74.153c-48.377,0-95.849,0-143.929,0
		c2.306,5.242,4.201,10.009,6.545,14.542c0.556,1.075,2.622,1.935,3.997,1.938c40.96,0.102,81.92,0.101,122.881-0.001
		c1.367-0.004,3.424-0.875,3.98-1.952C186.798,84.15,188.687,79.388,190.986,74.153z M178.8,101.448c-40.221,0-79.68,0-119.543,0
		c2.036,4.697,3.645,9.059,5.84,13.102c0.734,1.352,2.966,2.672,4.52,2.678c32.986,0.154,65.975,0.135,98.961,0.051
		c1.268-0.004,3.203-0.637,3.686-1.568C174.597,111.198,176.542,106.483,178.8,101.448z M151.755,152.062
		c-8.736-0.059-15.156,5.912-15.268,14.201c-0.108,8.145,6.594,14.857,14.876,14.896c8.248,0.039,15.011-6.613,14.997-14.754
		C166.347,158.198,160.158,152.12,151.755,152.062z M67.889,152.062c-8.872-0.021-14.947,5.838-14.933,14.4
		c0.014,8.299,6.555,14.736,14.925,14.693c8.258-0.041,14.454-6.203,14.534-14.455C82.501,157.749,76.88,152.083,67.889,152.062z"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M11.595,22.01c2.25,2,3.731,5.242,4.988,8.167
		c13.565,31.565,27.04,63.168,40.319,94.854c1.282,3.059,3.176,2.809,5.465,2.809c34.302,0.002,68.603-0.006,102.905,0.01
		c5.764,0.004,8.554,2.027,9.061,6.396c0.548,4.719-2.344,8.506-7.545,8.525c-37.465,0.148-74.931,0.145-112.395,0.004
		c-4.668-0.018-7.854-2.846-9.729-7.328c-8.968-21.43-18.047-42.813-27.136-64.193C11.826,57.836,6.037,44.456,0.287,31.058
		c-0.941-4.298,0.639-6.173,1.684-7.798C4.154,20.875,8.03,20.085,11.595,22.01z"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M203.261,48.056c-1.695,3.321-3.852,6.496-4.969,10.002
		c-1.386,4.354-3.952,5.114-8.133,5.066c-19.66-0.226-39.322-0.101-58.984-0.101c-27.827,0-55.654-0.109-83.479,0.114
		c-4.369,0.035-6.732-1.297-8.095-5.32c-1.16-3.423-2.746-6.702-4.443-10.762c56.357,0,112.229,0,168.103,0
		C203.261,47.39,203.261,47.723,203.261,48.056z"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M190.986,74.153c-2.299,5.235-4.188,9.997-6.525,14.527
		c-0.557,1.077-2.613,1.948-3.98,1.952c-40.961,0.102-81.921,0.103-122.881,0.001c-1.375-0.003-3.44-0.862-3.997-1.938
		c-2.345-4.534-4.24-9.3-6.545-14.542C95.137,74.153,142.609,74.153,190.986,74.153z"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M178.8,101.448c-2.258,5.035-4.203,9.75-6.537,14.262
		c-0.482,0.932-2.418,1.564-3.686,1.568c-32.986,0.084-65.975,0.104-98.961-0.051c-1.554-0.006-3.786-1.326-4.52-2.678
		c-2.195-4.043-3.804-8.404-5.84-13.102C99.121,101.448,138.58,101.448,178.8,101.448z"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M151.755,152.062c8.402,0.059,14.592,6.137,14.605,14.344
		c0.014,8.141-6.749,14.793-14.997,14.754c-8.282-0.039-14.984-6.752-14.876-14.896
		C136.599,157.974,143.019,152.003,151.755,152.062z"/>
    <path fill-rule="evenodd" clip-rule="evenodd" d="M67.889,152.062c8.991,0.021,14.612,5.688,14.526,14.639
		c-0.08,8.252-6.275,14.414-14.534,14.455c-8.37,0.043-14.911-6.395-14.925-14.693C52.942,157.899,59.018,152.04,67.889,152.062z"/>
</g>
</svg>
        <span>GoodPharma</span>
    </div>
    <a href="<?php echo HTTP_SERVER ?>san-pham.html">Tiếp tục mua sắm</a>
</div>


<div class="cart__content__progress">
    <div class="cart__content__progress__inner checked">
        <div class="cart__content__progress__bar">
            <div class="cart__content__progress__text">
                Giỏ hàng
            </div>
        </div>
        <div class="cart__content__progress__circle">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/>
            </svg>
        </div>
    </div>

    <div class="cart__content__progress__inner">
        <div class="cart__content__progress__bar">
            <div class="cart__content__progress__text">
                Giao hàng
            </div>
        </div>
        <div class="cart__content__progress__circle">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/>
            </svg>
        </div>
    </div>
    <div class="cart__content__progress__inner">
        <div class="cart__content__progress__bar">
            <div class="cart__content__progress__text">
                Thanh toán
            </div>
        </div>
        <div class="cart__content__progress__circle">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/>
            </svg>
        </div>
    </div>
    <div class="cart__content__progress__inner">
        <div class="cart__content__progress__bar">
            <div class="cart__content__progress__text">
                Hoàn tất
            </div>
        </div>
        <div class="cart__content__progress__circle">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                <path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/>
            </svg>
        </div>
    </div>
    <div class="cart__content__progress__circle2">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
            <path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/>
        </svg>
    </div>
</div>
<div class="cart__content__products">
    <?php if($device != 'mobile') { ?>
    <table>
        <tr>
            <th style="width: 45%">Sản phẩm</th>
            <th style="width: 20%; text-align: right">Giá</th>
            <th style="width: 20%; text-align: center">Số lượng</th>
            <th style="width: 15%; text-align: right;">Thành tiền</th>
        </tr>
        <?php if($cartData["data"]["products"]) foreach($cartData["data"]["products"] as $product) { ?>
        <tr>
            <td class="cart__content__products__product">
                <a href="javascript:void(0)" class="button__delete gbBtn" data-target="modal__delete"
                   data-cartcode="<?php echo @$_SESSION['cartcode']?>"
                   data-productsku="<?php echo $product['skucode']?>">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512">
                        <!-- Font Awesome Free 5.15.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) -->
                        <path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"/>
                    </svg>
                </a>
                <img width="80" height="80" class="" alt="<?php echo $product['productname']?>"
                     srcset="<?php echo IMAGE_SERVER.'resize-80x80/'.$product['image'] . '?v=' . IMAGE_VERSION ?> 1.25x, <?php echo IMAGE_SERVER.'resize-80x80/'.$product['image'] . '?v=' . IMAGE_VERSION ?> 2x"
                     src="<?php echo IMAGE_SERVER.'resize-80x80/'.$product['image'] . '?v=' . IMAGE_VERSION ?>">

                <div class="cart__content__products__info">
                    <div class="cart__content__products__name">
                        <?php echo $product["productname"]; ?>
                    </div>
                    <div class="cart__content__products__option">
                        <?php if(!empty($product["optionvalue"])) { ?>
                        <?php foreach($product["optionvalue"] as $key => $option ){ ?>
                        <div>
                            <?php echo $key.": ".$option ?>
                        </div>
                        <?php } ?>
                        <?php } ?>
                    </div>
                </div>
            </td>
            <td class="cart__content__products__value">
                <?php if ($product["baseprice"] != $product["sellingprice"]){ ?>
                <div id="<?php echo $product['skucode']?>-basePrice" class="cart__content__products__oldPrice">
                    <?php echo number_format(intval($product["baseprice"]), 0, '.', '.'); echo $cartData["data"]["currency"]; ?>
                </div>
                <?php } ?>

                <div id="<?php echo $product['skucode']?>-sellingPrice" class="cart__content__products__currentPrice">
                    <?php echo number_format(intval($product["sellingprice"]), 0, '.', '.'); echo $cartData["data"]["currency"]; ?>
                </div>

                <?php if ($product["promotioncode"]){ ?>
                <div id="<?php echo $product['skucode']?>-promotion-row" class="cart__content__products__code">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                        <path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/>
                    </svg>
                    <span id="<?php echo $product['skucode']?>-promotion"><?php echo $product["promotioncode"].'(-'.number_format(intval($product["discountamountperitem"]), 0, '.', '.').$cartData["data"]["currency"].')' ?></span>
                </div>
                <?php } ?>
            </td>
            <td class="cart__content__products__count">
                <div class="cart__content__products__number__input" data-sku="<?php echo $product['skucode']?>">
                    <input type="button" value="-" class="button-minus" data-field="quantity">
                    <input type="number" step="1" max="" value="<?php echo $product['quantity'] ?>"
                           name="quantity" class="quantity-field">
                    <input type="button" value="+" class="button-plus" data-field="quantity">
                </div>
            </td>
            <td class="cart__content__products__price">
                <?php if ($product["basesubtotal"] != $product["sellingsubtotal"]){ ?>
                <div id="<?php echo $product['skucode']?>-productPrice" class="cart__content__products__oldPrice">
                    <?php echo number_format(intval($product["basesubtotal"]), 0, '.', '.') . $cartData["data"]["currency"]  ?>
                </div>
                <?php } ?>
                <div id="<?php echo $product['skucode']?>-productSubtotal"
                     class="cart__content__products__currentPrice">
                    <?php echo number_format(intval($product["subtotal"]), 0, '.', '.') . $cartData["data"]["currency"]; ?>
                </div>
            </td>
        </tr>
        <?php } ?>

    </table>
    <?php } else { ?>
    <div class="cart__content__mobile">
        <?php if ($cartData["data"]["products"]) foreach($cartData["data"]["products"] as $product) { ?>
        <div class="cart__content__mobile--row">
            <div class="cart__content__products__product">
                <a href="javascript:void(0)" class="button__delete gbBtn" data-target="modal__delete"
                   data-cartcode="<?php echo @$_SESSION['cartcode']?>"
                   data-productsku="<?php echo $product['skucode']?>">X</a>
                <img width="80" height="80" class="" alt=""
                     srcset="<?php echo IMAGE_SERVER.'resize-80x80/'.$product['image'] . '?v=' . IMAGE_VERSION ?> 1.25x, <?php echo IMAGE_SERVER.'resize-80x80/'.$product['image'] . '?v=' . IMAGE_VERSION ?> 2x"
                     src="<?php echo IMAGE_SERVER.'resize-80x80/'.$product['image'] . '?v=' . IMAGE_VERSION ?>">

                <div class="cart__content__products__info">
                    <div class="cart__content__products__name">
                        <?php echo $product["productname"]; ?>
                    </div>
                    <div class="cart__content__products__option">
                        <?php if(!empty($product["optionvalue"])) { ?>
                        <?php foreach($product["optionvalue"] as $key => $option ){ ?>
                        <div>
                            <?php echo $key.": ".$option ?>
                        </div>
                        <?php } ?>
                        <?php } ?>
                    </div>
                </div>
            </div>
            <div class="cart__content__products__orders">
                <div class="cart__content__products__value">
                    <span>Giá</span>
                    <?php if ($product["baseprice"] != $product["sellingprice"]){ ?>
                    <div id="<?php echo $product['skucode']?>-basePrice" class="cart__content__products__oldPrice">
                        <?php echo number_format(intval($product["baseprice"]), 0, '.', '.'); echo $cartData["data"]["currency"]; ?>
                    </div>
                    <?php } ?>
                    <div id="<?php echo $product['skucode']?>-sellingPrice"
                         class="cart__content__products__currentPrice">
                        <?php echo number_format(intval($product["sellingprice"]), 0, '.', '.'); echo $cartData["data"]["currency"]; ?>
                    </div>

                    <?php if ($product["promotioncode"]){ ?>
                    <div id="<?php echo $product['skucode']?>-promotion-row" class="cart__content__products__code">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                            <path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/>
                        </svg>

                        <span id="<?php echo $product['skucode']?>-promotion"><?php echo $product["promotioncode"].'(-'.number_format(intval($product["discountamountperitem"]), 0, '.', '.').$cartData["data"]["currency"].')' ?></span>
                    </div>
                    <?php } ?>

                </div>
                <div class="cart__content__products__count">
                    <span>Số lượng</span>

                    <div class="cart__content__products__number__input" data-sku="<?php echo $product['skucode']?>">
                        <input type="hidden" name="sku" value="<?php echo $product['sku']?>">
                        <input type="button" value="-" class="button-minus" data-field="quantity">
                        <input type="number" step="1" max="" value="<?php echo $product['quantity'] ?>"
                               name="quantity" class="quantity-field">
                        <input type="button" value="+" class="button-plus" data-field="quantity">
                    </div>
                </div>
                <div class="cart__content__products__price">
                    <span>Thành tiền</span>
                    <?php if($product["basesubtotal"] != $product["subtotal"]) { ?>
                    <div id="<?php echo $product['skucode']?>-productPrice" class="cart__content__products__oldPrice">
                        <?php echo number_format(intval($product["basesubtotal"]), 0, '.', '.'); echo $cartData["data"]["currency"]; ?>
                    </div>
                    <?php } ?>
                    <div id="<?php echo $product['skucode']?>-productSubtotal"
                         class="cart__content__products__currentPrice">
                        <?php echo number_format(intval($product["subtotal"]), 0, '.', '.'); echo $cartData["data"]["currency"]; ?>
                    </div>
                </div>
            </div>
        </div>
        <?php } ?>

    </div>
    <?php } ?>
</div>

<div class="cart__content__total container">
    <?php if($device != 'mobile') { ?>
    <div class="cart__content__total__row row">

        <div class="cart__content__total__code col-lg-8">
            <div>Mã khuyến mãi</div>
            <div class="d-flex">
                <input type="text" name="salecode">
                <a class="gbBtn btn__checkpromotion">Kiểm tra</a>
            </div>


            <p class="promotioncode__errorfield"></p>
            <i>Bạn có thể nhập nhiều mã để áp dụng cho sản phẩm & đơn hàng</i>
        </div>

        <div class="cart__content__total__sum col-lg-4">
            <div class="cart__content__total__sum__row">
                <span>Cộng giỏ hàng</span>

                <div id="cart-totallines"
                     class="cart__content__total__sum__price"><?php echo number_format($cartData["data"]["totallines"], 0, '.', '.'); echo $cartData["data"]["currency"]; ?>
                </div>
            </div>
            <?php if ($cartData["data"]["discountamount"]) { ?>
            <div id="cart-promotion-row" class="cart__content__total__sum__row">
                <div class="cart__content__total__code col-lg-8">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                        <path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/>
                    </svg>
                    <span id="cart-promotioncode"><?php echo $cartData["data"]["promotioncode"] ?></span>
                </div>
                <div id="cart-discountamount" class="cart__content__total__sum__sale">
                    (-<?php echo number_format($cartData["data"]["discountamount"], 0, '.', '.');; echo $cartData["data"]["currency"]; ?>)
                </div>
            </div>
            <?php } ?>
            <?php if ($cartData["data"]["shipcost"] != 0) { ?>
            <div id="shippingfee__row" class="cart__content__total__sum__row--total d-flex mb-3" style="justify-content: space-between;">
                <span>Phí vận chuyển</span>
                <div id="shippingfee" class="cart__content__total__sum__price"><?php echo number_format($cartData['data']['shipcost'], 0, '.', '.') ?> <?php echo $cartData["data"]["currency"]?></div>
            </div>
            <?php } ?>
            <hr>
            <div class="cart__content__total__sum__row" style="padding-bottom: 0;">
                <span class="total__title">Tổng tạm tính</span>

                <div id="cart-ordertotal"
                     class="total__price"><?php echo number_format($cartData["data"]["totalorder"], 0, '.', '.'); echo $cartData["data"]["currency"]; ?>
                </div>
            </div>
            <!--
            <?php if($cartData["data"]["totalorder"] != $cartData["data"]["totallines"]){ ?>
            <div id="cart-totallines-summary"
                 class="total__lines"><?php echo number_format($cartData["data"]["totallines"], 0, '.', '.'); echo $cartData["data"]["currency"]; ?>
            </div>
            <?php } ?>
            -->
            <a href="javascript:void(0)" class="continue__order">Tiến hành đặt hàng</a>

        </div>
    </div>
    <?php } else { ?>
    <div class="cart__content__total__row--mobile">
        <div class="cart__content__total__sum">
            <div class="cart__content__total__sum__row">
                <span>Cộng giỏ hàng</span>

                <div id="cart-totallines"
                     class="cart__content__total__sum__price"><?php echo number_format(intval($cartData["data"]["totallines"]), 0, '.', '.'); echo $cartData["data"]["currency"]; ?></div>
            </div>

            <?php if ($cartData["data"]["discountamount"]) { ?>
            <div id="cart-promotion-row" class="cart__content__total__sum__row">
                <div class="cart__content__total__code">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512">
                        <path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/>
                    </svg>
                    <span id="cart-promotioncode"><?php echo $cartData["data"]["promotioncode"] ?></span>
                </div>
                <div id="cart-discountamount" class="cart__content__total__sum__sale">
                    (-<?php echo number_format(intval($cartData["data"]["discountamount "]), 0, '.', '.'); echo $cartData["data"]["currency"]; ?>)
                </div>
            </div>
            <?php } ?>
            <?php if ($cartData["data"]["shipcost"] != 0) { ?>
            <div id="shippingfee__row" class="cart__content__total__sum__row--total d-flex mb-3" style="justify-content: space-between;">
                <span>Phí vận chuyển</span>
                <div id="shippingfee" class="cart__content__total__sum__price"><?php echo number_format($cartData['data']['shipcost'], 0, '.', '.') ?> <?php echo $cartData["data"]["currency"]?></div>
            </div>
            <?php } ?>

            <div class="cart__content__total__code">
                <div class="d-flex">
                    <input class="d-inline-block mr-2" placeholder="Nhập mã khuyến mãi" type="text" name="salecode">
                    <a class="btn__checkpromotion d-inline-block">Kiểm tra</a>
                </div>

                <p class="promotioncode__errorfield"></p>
                <i><p>Bạn có thể nhập nhiều mã để áp dụng cho sản phẩm & đơn hàng</p></i>
            </div>
            <hr>

            <div class="cart__content__total__sum__row">
                <span class="total__title">Tổng tạm tính</span>

                <div id="cart-ordertotal"
                     class="total__price"><?php echo number_format(intval($cartData["data"]["totalorder"]), 0, '.', '.'); echo $cartData["data"]["currency"]; ?></div>
            </div>
<!--
            <?php if($cartData["data"]["totalorder"] != $cartData["data"]["totallines"]){ ?>
            <div id="cart-totallines-summary"
                 class="total__lines" style="    text-decoration: line-through; text-align: right; padding-bottom: 15px;"><?php echo number_format($cartData["data"]["totallines"], 0, '.', '.'); echo $cartData["data"]["currency"]; ?>
            </div>
            <?php } ?>
            -->

            <a href="javascript:void(0)"
               class="continue__order">Tiến hành đặt hàng</a>

        </div>
    </div>
    <?php } ?>
</div>

<!-- The Modal -->

<div id="modal__promotion" class="gbmodal">
    <!-- Modal content -->
    <div class="gbmodal__inner">
        <form id="frm__promotion" class="gbmodal__content text-center">
            <div class="promotion__status">Xác thực mã khuyến mãi thành công: <span id="promotion__code"></span></div>
            <div class="promotion__description">
                <p id="promotion__name">Chương trình giảm giá nhân dịp giáng sinh</p>

                <p class="promotion__description__value">Giảm <span id="promotion__value">10%</span></p>

                <p>Từ ngày <span id="promotion__startdate"></span> đến <span id="promotion__enddate"></span></p>

                <p id="promotion__condition"></p>
            </div>
            <input type="hidden" name="promotioncode" value>
            <input type="hidden" name="applyto" value>

            <div id="promotion__skus__inner" style="display: none;">
                <p>Chọn sản phẩm để áp dụng cho:</p>

                <div id="promotion__skus" class="promotion__checkbox__sku row">
                    <!--
                    <p>
                        <input type="checkbox" id="test1" name="productids[]" checked>
                        <label for="test1">Giày Adidas 2020</label>
                    </p>
                    -->
                </div>
                <p id="promotion__skus__errorfield"></p>
            </div>
            <div class="gbFooter">
                <a type="button" class="promotion__close gbclose" style="position: static">Bỏ qua</a>
                <button type="submit" class="promotion__apply">Áp dụng</button>
            </div>
        </form>
    </div>
</div>


<div id="modal__delete" class="gbmodal">
    <!-- Modal content -->
    <div class="gbmodal__inner">
        <form id="frm__delete" class="gbmodal__content">
            <h3>Xác nhận xóa sản phẩm này?</h3>

            <div class="gbFooter">
                <a type="button" class="gbclose" style="position: static">Bỏ qua</a>

                <button type="submit" class="gbdelete">Xóa sản phẩm</button>
            </div>
        </form>
    </div>
</div>


<script>
    var currency = "<?php echo $cartData['data']['currency'] ?>";
    function incrementValue(e) {
        e.preventDefault();
        var fieldName = e.target.getAttribute('data-field');
        var parent = e.target.closest('div');
        var currentVal = parseInt(parent.querySelector('input[name=' + fieldName + ']').value, 10);

        if (!isNaN(currentVal)) {
            parent.querySelector('input[name=' + fieldName + ']').value = currentVal + 1;
        } else {
            parent.querySelector('input[name=' + fieldName + ']').value = 1;
        }
        updateQuantityProduct(e);
        cartAnimate();
    }

    function decrementValue(e) {
        e.preventDefault();
        var fieldName = e.target.getAttribute('data-field');
        var parent = e.target.closest('div');
        var currentVal = parseInt(parent.querySelector('input[name=' + fieldName + ']').value, 10);

        if (!isNaN(currentVal) && currentVal > 1) {
            parent.querySelector('input[name=' + fieldName + ']').value = currentVal - 1;
        } else {
            parent.querySelector('input[name=' + fieldName + ']').value = 1;
        }
        updateQuantityProduct(e);
        cartAnimate();
    }

    function decrementValueNotUpdateQuantity(e) {
        e.preventDefault();
        var fieldName = e.target.getAttribute('data-field');
        var parent = e.target.closest('div');
        var currentVal = parseInt(parent.querySelector('input[name=' + fieldName + ']').value, 10);

        if (!isNaN(currentVal) && currentVal > 1) {
            parent.querySelector('input[name=' + fieldName + ']').value = currentVal - 1;
        } else {
            parent.querySelector('input[name=' + fieldName + ']').value = 1;
        }
    }

    function updateQuantityProduct(e) {
        showLoading();
        var parent = e.target.closest('div');

        var formData = new FormData();
        var cartcode = "<?php echo $cartData['data']['cartcode'] ?>", sku = parent.getAttribute("data-sku"), quantity = parent.querySelector("input[type=number]").value;

        formData.append('cartcode', cartcode);
        formData.append('productsku', sku);
        formData.append('quantity', quantity);

        xhr("<?php echo HTTP_SERVER ?>gbshop/ajax/addProductToCart.gbe", formData, function (res) {
            var response = JSON.parse(res);
            var data = response.data;

            if(response.status == 'failed') {
                document.querySelector("#modal__productoutofstock .modal__content").innerHTML = data.productname + " chỉ còn " + "<strong class='text-danger'>" + data.quantity_available + " sản phẩm</strong>";
                document.querySelector("#modal__productoutofstock").style.display = "flex";

            } else {
                document.querySelector(".number_of_product").innerHTML = data.countquantityproductincart;
                data.products.forEach(function (product, index) {
                    var baseprice = document.querySelector("#" + product.skucode + "-basePrice");
                    var sellingprice = document.querySelector("#" + product.skucode + "-sellingPrice");
                    var promotion = document.querySelector("#" + product.skucode + "-promotion");
                    var promotion_row = document.querySelector("#" + product.skucode + "-promotion-row");
                    var productprice = document.querySelector("#" + product.skucode + "-productPrice");
                    var productsubtotal = document.querySelector("#" + product.skucode + "-productSubtotal");

                    if (baseprice != null) {
                        baseprice.innerHTML = numberWithDot(product.baseprice) + currency;
                    }

                    //promotion per item
                    if (promotion != null && product.discountamountperitem != 0) {
                        promotion.innerHTML = product.promotioncode + '(-' + numberWithDot(product.discountamountperitem) + currency + ')';
                    } else if(product.discountamountperitem == 0 && promotion_row != null) {
                        promotion_row.style.display = "none";
                    }

                    if (productprice != null) {
                        productprice.innerHTML = numberWithDot(product.basesubtotal) + currency;
                    }

                    sellingprice.innerHTML = numberWithDot(product.sellingprice) + currency;
                    productsubtotal.innerHTML = numberWithDot(product.subtotal) + currency;
                });

                var cart_ordertotal = document.querySelector("#cart-ordertotal");
                var cart_promotion_row = document.querySelector("#cart-promotion-row");
                var cart_promotioncode = document.querySelector("#cart-promotioncode");
                var cart_discountamount = document.querySelector("#cart-discountamount");
                var cart_totallines = document.querySelector("#cart-totallines");
                var cart_totallines_summary = document.querySelector("#cart-totallines-summary");

                //promotion on cart
                if (cart_promotioncode != null) {
                    cart_promotioncode.innerHTML = data.promotioncode;
                }

                if (cart_discountamount != null) {
                    cart_discountamount.innerHTML = "(-" + numberWithDot(data.discountamount) + currency + ")";
                }

                if ((cart_promotion_row != null) && (data.discountamount == 0)) {
                    cart_promotion_row.style.display = "none";
                }

                cart_ordertotal.innerHTML = numberWithDot(data.totalorder) + currency;
                cart_totallines.innerHTML = numberWithDot(data.totallines) + currency;

                if (cart_totallines_summary != null) {
                    cart_totallines_summary.innerHTML = numberWithDot(data.totallines) + currency;
                }

            }
            endLoading();
        });
    }

    $('.cart__content__products__number__input').on('click', '.button-plus', function (e) {
        incrementValue(e);
    });

    $('.cart__content__products__number__input').on('click', '.button-minus', function (e) {
        decrementValue(e);
    });

    $(".btn__checkpromotion").click(function () {
        var salecode = $("input[name=salecode]").val();

        var formData = new FormData();
        formData.append('promotioncode', salecode);

        xhr("<?php echo HTTP_SERVER ?>gbshop/ajax/validatePromotionCode.gbe", formData, function (res) {
            var data = JSON.parse(res);
            if (data.status == 'failed') {
                document.querySelectorAll(".promotioncode__errorfield").forEach(function (e) {
                    e.innerHTML = data.error;
                });
            } else {
                data = data['data'];
                document.querySelector("#modal__promotion").style.display = "flex";
                document.querySelector("#promotion__code").innerHTML = data.promotioncode;
                document.querySelector("#promotion__name").innerHTML = data.promotionname;

                if (data.type == 'percent') {
                    document.querySelector("#promotion__value").innerHTML = data.value + '%';
                } else {
                    document.querySelector("#promotion__value").innerHTML = numberWithDot(data.value) + currency;
                }

                document.querySelector("#promotion__startdate").innerHTML = data.startdate;
                document.querySelector("#promotion__enddate").innerHTML = data.enddate;

                document.querySelector("input[name=promotioncode]").value = data.promotioncode;

                if (data.fromvalue != 0) {
                    document.querySelector("#promotion__condition").innerHTML = 'Áp dụng cho mọi đơn hàng từ ' + numberWithDot(data.fromvalue) + currency;
                } else if (data.tovalue != 0) {
                    document.querySelector("#promotion__condition").innerHTML = 'Áp dụng cho mọi đơn hàng từ ' + numberWithDot(data.fromvalue) + currency + ' , tối đa ' + data.tovalue + currency;
                }

                document.querySelector("input[name=applyto]").value = data.applyto;

                if (data.applyto == 'product') {
                    var element = "";

                    if (Object.keys(data.applytoproducts).length !== 0 && data.applytoproducts.constructor === Object) {
                        var products = data.applytoproducts;
                        for (var productid in products) {
                            element += '<p class="col-md-6 col-lg-4"> <input type="checkbox" id="' + productid + '" name="productids[]" value="' + productid + '"> <label for="' + productid + '">' + products[productid] + '</label> </p>';
                        }
                    }
                    document.querySelector("#promotion__skus").innerHTML = element;
                    document.querySelector("#promotion__skus__inner").style.display = "block";
                }
            }
        });
    });

    document.querySelector("#frm__delete").addEventListener("submit", function (e) {
        e.preventDefault();
        showLoading();
        var formData = new FormData(document.querySelector("#frm__delete"));
        xhr(main_http_server + "gbshop/ajax/deleteProductInCart.gbe", formData, function (res) {
            endLoading();
            var data = JSON.parse(res);
            if (data.status == 'done') {
                location.reload();

            } else {
                e.target.style.display = "none";
                alert(data.error);
            }
        });
    });

    document.querySelector("#frm__promotion").addEventListener("submit", function (e) {
        e.preventDefault();
        var formData = new FormData(document.querySelector("#frm__promotion"));
        showLoading();
        xhr("<?php echo HTTP_SERVER ?>gbshop/ajax/applyPromotionCode.gbe", formData, function (res) {
            var response = JSON.parse(res);
            if (response.status != 'failed') {
                location.reload();
            } else {
                document.querySelector("#promotion__skus__errorfield").innerHTML = response.error;
                endLoading();
            }
        });
    });

    var quantityinputs = document.querySelectorAll("input[name=quantity]");
    quantityinputs.forEach(function (quantityinput) {
        quantityinput.addEventListener("change", function (e) {
            var quanityvalue = parseInt(quantityinput.value);
            if(quanityvalue < 1) {
                quantityinput.value = 1;
            }
            updateQuantityProduct(e);
        });
    });

    var continueOrderBtns = document.querySelectorAll(".continue__order");
    continueOrderBtns.forEach(function(continueOrder) {
        continueOrder.addEventListener("click", function() {
            showLoading();
            var formData = new FormData();
            formData.append('cartcode', "<?php echo @$_SESSION['cartcode']?>");

            xhr("<?php echo HTTP_SERVER ?>gbshop/ajax/checkProductAvailabilityInCart.gbe", formData, function (res) {
                var response = JSON.parse(res);
                var data = response.data;
                if(response.status == 'failed') {
                    if(response.error_field == 'quantity') {
                        document.querySelector("#modal__productoutofstock .modal__content").innerHTML = data.productname + " chỉ còn " + "<strong class='text-danger'>" + data.quantity_available + " sản phẩm</strong>";
                        document.querySelector("#modal__productoutofstock").style.display = "flex";
                    } else {
                        document.querySelector("#modal__productoutofstock .modal__content").innerHTML = response.error;
                        document.querySelector("#modal__productoutofstock").style.display = "flex";
                    }
                } else {
                    location.href = main_http_server + "gbshop/shoppingcart/shipping.gbe";
                }
                endLoading();
            });
        });
    });
</script>